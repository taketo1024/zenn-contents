---
title: "4.4 練習問題"
---

取りうる引数の一部について定義されてない関数は部分関数と呼ばれる．これは数学的な意味で真の関数ではないので，標準的な圏論のフレームワークには合わない．しかしながら，装飾付きの型 `optional` を返す型として表現することはできる．

```cpp
template<class A> class optional {
    bool _isValid;
    A _value;
public:
    optional()    : _isValid(false) {}
    optional(A v) : _isValid(true), _value(v) {}
    bool isValid() const { return _isValid; }
    A value() const { return _value; }
};
```

たとえば装飾付き関数 `safe_root` の実装は次のようになる．

```cpp
optional<double> safe_root(double x) {
    if (x >= 0) return optional<double>{sqrt(x)};
    else return optional<double>{};
}
```

これをふまえ，以下の設問に答えよ．

1. 部分関数についてクライスリ圏を構成せよ．（合成と恒等射を定義せよ）
2. 引数がゼロ除算でなければ除算結果を返す装飾付き関数 `safe_reciprocal` を実装せよ．
3. `sqrt(1/x)` が計算できる場合にはこれを返す関数 `safe_root_reciprocal` を，`safe_root` と `safe_reciprocal` を合成して実装せよ．

（和訳：[@takase](https://zenn.dev/takase)）